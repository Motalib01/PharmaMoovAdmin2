@using PharmaMoov.Models.User
@model UserHelpRequestView
@{
    ViewData["Title"] = "Demande d’aide";
    Layout = "~/Views/Shared/_SALayout.cshtml";
}


<div class="row p-3 p-lg-5">
    <div class="col-sm-12">
        <nav aria-label="breadcrumb">
            <h3 class="mb-4">Demande d’aide</h3>
        </nav>

        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-2"><span class="text-center font-weight-bolder">Order #</span></div>
                    <div class="col-md-10"><span class="text-center font-weight-lighter">@Model.OrderId</span></div>
                </div>

                <div class="row">
                    <div class="col-md-2"><span class="text-center font-weight-bolder">Nom</span></div>
                    <div class="col-md-10"><span class="text-center font-weight-lighter">@Model.UserFullName</span></div>
                </div>

                <div class="row">
                    <div class="col-md-2"><span class="text-center font-weight-bolder">Mobile Number</span></div>
                    <div class="col-md-10"><span class="text-center font-weight-lighter">@Model.UserMobileNumber</span></div>
                </div>

                <div class="row">
                    <div class="col-md-2"><span class="text-center font-weight-bolder">Description</span></div>
                    <div class="col-md-10"><span class="text-center font-weight-lighter">@Model.Description</span></div>
                </div>

                <div class="row mt-4">
                    <div class="col-sm-12 ">
                        <a class="btn white-button mr-3 btn-padding" href="~/SAdmin/HelpRequest">Retourner</a>
                        @if (Model.RequestStatus == PharmaMoov.Models.HelpRequestStatus.PENDING)
                        {
                            <button type="button" onclick="markAsResolved(@Model.UserHelpRequestRecordID, 2)" class="btn login-button mr-3 btn-padding">Résoudre</button>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script type="text/javascript">
        function markAsResolved(rid, status) {
            var parameters = {
                RecordId: rid,
                HelpRequestStatus: status
            }

            $.ajax(
                {
                    type: 'POST',
                    url: BASEPATH + '/SAdmin/ChangeHelpRequestStatus',
                    contentType: 'application/json',
                    data: JSON.stringify(parameters),
                    success: function (result) {
                        window.location.replace(BASEPATH + "/SAdmin/HelpRequest");
                    },
                    failed: function (e, x, h) {
                        console.log(e); console.log(h); console.log(x);
                    }
                }
            );
        }
    </script>
    }