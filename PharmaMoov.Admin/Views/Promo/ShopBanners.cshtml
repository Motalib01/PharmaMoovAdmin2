@using PharmaMoov.Models.Campaign
@model IEnumerable<CampaignDTO>

@{
    ViewData["Title"] = "Banners";
    Layout = "~/Views/Shared/_SALayout.cshtml";
}

<div class="row p-3 p-lg-5">
    <div class="col-sm-12">
        <nav aria-label="breadcrumb">
            <h3>Bannières</h3>
        </nav>

        <div class="col-sm-12 d-flex justify-content-end mb-3">
            <a class="btn login-button btn-padding waves-effect waves-light" href="~/Promo/AddBanner">Ajouter une bannière</a>
        </div>

        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="tab-content" id="myTabContent">
                            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                                <div class="table-responsive-sm">
                                    <table class="table table-hover table-bordered display table-striped" id="dtMainList">
                                        <thead class="thead-light">
                                            <tr>
                                                <th scope="col" class="th-sm font-weight-bold">ID</th>
                                                <th scope="col" class="th-sm font-weight-bold">Image</th>
                                                <th scope="col" class="th-sm font-weight-bold" style='width:20%;'>Nom de la boutique</th>
                                                <th scope="col" class="th-sm font-weight-bold">Type de bannières</th>
                                                <th scope="col" class="th-sm font-weight-bold">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>


                                            @if (Model != null)
                                            {
                                                @foreach (var banner in Model)
                                                {
                                                    <tr>
                                                        <td class="categoryID">@banner.CampaignRecordID</td>
                                                        <td class="categoryImage"><img src="@banner.ImageUrl" style='width:100%;'></td>
                                                        <td class="categoryName">@banner.RelatedShopName</td>
                                                        @if (banner.IsProductOfferBanner == true)
                                                        {
                                                            <td><p class="isCategoryFeatured badge badge-primary">En vedette</p></td>
                                                        }
                                                        else
                                                        {
                                                            <td><p class="isCategoryFeatured badge badge-success text-white">Page d’accueil</p></td>
                                                        }
                                                        <td><h5><a class="text-success action-edit" href="~/Promo/EditBanner?id=@banner.CampaignRecordID"><i class="fas fa-edit"></i></a></h5></td>
                                                    </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            //Super Admin > Add / Edit Product Category
            $("#imageLoadingUploadProductCategoryImage").hide();
            $(".spinner-border").hide();

            //add new category image
            $("#UploadProductCategoryImage").change(function () {
                validateProductImageFiles("UploadProductCategoryImage");
            });

            //edit category image
            $("#EditProductCategoryImage").change(function () {
                validateProductImageFiles("EditProductCategoryImage");
            });
            //Super Admin > Add / Edit Product Category

            $('#dtMainList').DataTable({
                "info": false,
                "lengthChange": false,
                "searching": false,
                "language": {
                    "info": "Afficher de _START_ à _END_ sur _TOTAL_ entrées",
                    "emptyTable": "Aucune donnée disponible dans le tableau",
                    "infoEmpty": "Affichage 0 à 0 sur 0 entrées",
                    "search": "Cherchez:",
                    "paginate": {
                        "first": "Premier",
                        "last": "Dernier",
                        "next": "Suivant",
                        "previous": "Précédent"
                    }
                },
            });
            $('.dataTables_length').addClass('bs-select');
        });

        $(document).on('click', 'a.action-edit', function () {
            $('#EditProdCategoryModal').modal("show");
            $('#error-msg-edit').text('');

            var categoryID = $(this).closest("tr").find(".categoryID").text();
            var categoryName = $(this).closest("tr").find(".categoryName").text();
            var categoryImage = $(this).closest("tr").find("img").attr("src");
            var categoryFeatured = $(this).closest("tr").find(".isCategoryFeatured").text();

            var categoryStatus = $(this).closest("tr").find(".categoryStatus").text();

            if (categoryStatus == 'True') {
                categoryStatus = 1;
            }
            else {
                categoryStatus = 0;
            }

            $('#CategoryID').val(categoryID);
            $('#CategoryName').val(categoryName);
           // $("#IsEnabled option[value='" + categoryStatus + "']").attr("selected", "selected");
            $("#IsEnabled").val(categoryStatus);
            if (categoryFeatured == "ACTIF")
            {
                $("#IsCategoryFeaturedEdit").prop("checked", true);
            } else
            {
                $("#IsCategoryFeaturedEdit").prop("checked", false);
            }

            //Category Icon Image
            $('#ProductCategoryImage').val(categoryImage);
            var ProductCategoryImage = $('#ProductCategoryImage').val();

            if (ProductCategoryImage != "") {
                $("#imgPrevEditProductCategoryImage").attr("src", ProductCategoryImage);
                $("#imgPrevEditProductCategoryImage").show();
            }
            //Category Icon Image

        });

        function loadAddModal() {
            $('#AddProdCategoryModal').modal("show");
            $('#ProductCategoryName').val("");
            $('#error-msg').text('');
        }

        function saveCategory() {
            var cName = $('#ProductCategoryName').val();
            var cImage = $('#ProductCategoryImage').val();
            var isActive = $('#IsActive').val();
            var isFeatured = $("input[id='IsCategoryFeatured']:checked").val();

            if (cName == '') {
                $('#error-msg').text("Nom de la catégorie requis");
            }
            else {

                if (isActive == 0) {
                    isActive = "false";
                }
                else {
                    isActive = "true";
                }

                if (isFeatured == "on") {
                    isFeatured = true;
                } else
                {
                    isFeatured = false;
                }
                console.log(isFeatured);
                var parameters = {
                    ProductCategoryName: cName,
                    ProductCategoryImage: cImage,
                    IsActive: isActive,
                    IsCategoryFeatured: isFeatured
                };

                $.ajax(
                    {
                        type: 'POST',
                        url: BASEPATH + '/ProductCategory/AddProductCategory',
                        contentType: 'application/json',
                        data: JSON.stringify(parameters),
                        success: function (result) {
                            if (result.statusCode == 200) {
                                window.location.replace(BASEPATH + "/ProductCategory/");
                            }
                            else {
                                $('#error-msg').text(result.message);
                            }
                        },
                        failed: function (e, x, h) {
                            console.log(e); console.log(h); console.log(x);
                        }
                    }
                );
            }
        }

        function editCategory() {
            var catID = $('#CategoryID').val();
            var cName = $('#CategoryName').val();
            var cImage = $('#ProductCategoryImage').val();
            var isActive = $('#IsEnabled').val();
            var isFeaturedVal = $("input[id='IsCategoryFeaturedEdit']:checked").val();;

            if (cName == '') {
                $('#error-msg-edit').text("Nom de la catégorie requis");
            }
            else {

                if (isActive == 0) {
                    isActive = "false";
                }
                else {
                    isActive = "true";
                }

                var isFeaturedBool = false;
                if (isFeaturedVal == "on") {
                    isFeatured = true;
                } else {
                    isFeatured = false;
                }
                var parameters = {
                    ProductCategoryId: catID,
                    ProductCategoryName: cName,
                    ProductCategoryImage: cImage,
                    IsActive: isActive,
                    IsCategoryFeatured: isFeatured
                };

                $.ajax(
                    {
                        type: 'POST',
                        url: BASEPATH + '/ProductCategory/EditProductCategory',
                        contentType: 'application/json',
                        data: JSON.stringify(parameters),
                        success: function (result) {
                            if (result.statusCode == 200) {
                                window.location.replace(BASEPATH + "/ProductCategory/");
                            }
                            else {
                                $('#error-msg-edit').text(result.message);
                            }
                        },
                        failed: function (e, x, h) {
                            console.log(e); console.log(h); console.log(x);
                        }
                    }
                );
            }
        }
    </script>
}
